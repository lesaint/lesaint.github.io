<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://www.javatronic.fr/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://www.javatronic.fr/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Sébastien Lesaint" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Apache, Linux, Testing, tips, " />

<meta property="og:title" content="Testing any Apache rewrite rule locally "/>
<meta property="og:url" content="https://www.javatronic.fr/posts/2014/11/04/testing-any-apache-rewrite-rule-locally/" />
<meta property="og:description" content="Recently, I had to write a bunch of Apache rewrite rules which applied to the whole URL, including the hostname. I also add to use RewriteMap for efficiency. I initially though this would be difficult to test locally but, in fact, with little modifications of a local Apache instance and …" />
<meta property="og:site_name" content="Javatronic" />
<meta property="og:article:author" content="Sébastien Lesaint" />
<meta property="og:article:published_time" content="2014-11-04T00:00:00+01:00" />
<meta name="twitter:title" content="Testing any Apache rewrite rule locally ">
<meta name="twitter:description" content="Recently, I had to write a bunch of Apache rewrite rules which applied to the whole URL, including the hostname. I also add to use RewriteMap for efficiency. I initially though this would be difficult to test locally but, in fact, with little modifications of a local Apache instance and …">

        <title>Testing any Apache rewrite rule locally  · Javatronic
</title>
        <link href="https://www.javatronic.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Javatronic - Full Atom Feed" />



    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://www.javatronic.fr/"><span class=site-name>Javatronic</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://www.javatronic.fr
                                    >Home</a>
                                </li>
                                <li ><a href="https://www.javatronic.fr/pages/sebastien_lesaint_resume/">Resume</a></li>
                                <li ><a href="https://www.javatronic.fr/pages/books-read/">Books read</a></li>
                                <li ><a href="https://www.javatronic.fr/categories.html">Categories</a></li>
                                <li ><a href="https://www.javatronic.fr/tags.html">Tags</a></li>
                                <li ><a href="https://www.javatronic.fr/archives.html">Archives</a></li>
                                <li><form class="navbar-search" action="https://www.google.com/search" onsubmit="return validateForm(this.elements['q'][0].value);" target="_blank"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"><input type="hidden" name="q" value="site:https://www.javatronic.fr"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://www.javatronic.fr/posts/2014/11/04/testing-any-apache-rewrite-rule-locally/">
                Testing any Apache rewrite rule locally
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#testing-rewrite-rules">Testing rewrite rules</a><ul>
<li><a href="#online">online</a></li>
<li><a href="#locally">locally</a></li>
</ul>
</li>
<li><a href="#installing-and-configuring-apache">Installing and configuring Apache</a><ul>
<li><a href="#install">install</a></li>
<li><a href="#enable-mod_rewrite">enable mod_rewrite</a></li>
</ul>
</li>
<li><a href="#modify-the-default-host">Modify the default host</a><ul>
<li><a href="#use-a-dedicated-conf-file">use a dedicated conf file</a></li>
<li><a href="#mod_rewrite-logging">mod_rewrite logging</a><ul>
<li><a href="#enable-logging">enable logging</a></li>
<li><a href="#read-mod_rewrite-logs">read mod_rewrite logs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#add-hosts-to-etchosts">Add hosts to /etc/hosts</a><ul>
<li><a href="#bind-apache-to-hostnames">bind Apache to hostnames</a></li>
<li><a href="#add-rewrite-rules">add rewrite rules</a></li>
<li><a href="#test-changes">test changes</a></li>
</ul>
</li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            <p>Recently, I had to write a bunch of Apache rewrite rules which applied to the whole URL, including the hostname. I also add to use <code>RewriteMap</code> for efficiency.</p>
<p>I initially though this would be difficult to test locally but, in fact, with little modifications of a local Apache instance and use of the <code>/etc/hosts</code> file, it's pretty easy.</p>
<p>This article will detail how I did it on my computer running Ubuntu and hopefully it will help others setup their own computer.</p>

<h1 id="testing-rewrite-rules">Testing rewrite rules<a class="headerlink" href="#testing-rewrite-rules" title="Permanent link">¶</a></h1>
<h2 id="online">online<a class="headerlink" href="#online" title="Permanent link">¶</a></h2>
<p>Online tools such as <a href="http://htaccess.madewithlove.be/">htaccess tester</a> exists and can come in handy to test simple rules but that are limited techically (they usually advertise their limitations) but also by design: e.g. they can not support <a href="http://httpd.apache.org/docs/current/en/mod/mod_rewrite.html#rewritemap">RewriteMap</a>.</p>
<blockquote>
<p>when working rules, <a href="http://regex101.com/#pcre">regex101.com</a> is pretty usefull to test regular expressions. Be sure to be in "pcre" mode as this is the intepretor used by Apache.</p>
</blockquote>
<h2 id="locally">locally<a class="headerlink" href="#locally" title="Permanent link">¶</a></h2>
<p>Testing locally is the only way to fully test the rewrite rules you write, you can even test various version of Apache (but I won't cover that here).</p>
<p>Fortunatly, it is not so complicated to set up a local instance to test even host-based rewrite rules.</p>
<h1 id="installing-and-configuring-apache">Installing and configuring Apache<a class="headerlink" href="#installing-and-configuring-apache" title="Permanent link">¶</a></h1>
<h2 id="install">install<a class="headerlink" href="#install" title="Permanent link">¶</a></h2>
<p>If you already have Apache installed, skip this.</p>
<p>Installation under Ubuntu is trivial:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>apache2
</code></pre></div>
<p>By default, the installed Apache instance is bound to port 80 and any host.</p>
<p>Make sure the instance not bound to a specific ip or host.</p>
<h2 id="enable-mod_rewrite">enable mod_rewrite<a class="headerlink" href="#enable-mod_rewrite" title="Permanent link">¶</a></h2>
<p>When installing Apache, <code>mod_rewrite</code> might not be installed by default.</p>
<p>Under Ubuntu, just add a link in directory <code>/etc/apache2/mods-enabled</code> to the <code>rewrite.load</code> file in <code>/etc/apache2/mods-available</code>;</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/etc/apache2/mods-enabled
ln<span class="w"> </span>-s<span class="w"> </span>../mods-available/rewrite.load
</code></pre></div>
<h1 id="modify-the-default-host">Modify the default host<a class="headerlink" href="#modify-the-default-host" title="Permanent link">¶</a></h1>
<h2 id="use-a-dedicated-conf-file">use a dedicated conf file<a class="headerlink" href="#use-a-dedicated-conf-file" title="Permanent link">¶</a></h2>
<p>Open file <code>000-default.conf</code> where the default host is configured.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/apache2/sites-available/000-default.conf
</code></pre></div>
<p>The default host is bound to any host on port 80:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">*:80</span><span class="nt">&gt;</span>
</code></pre></div>
<p>Add an <code>Include</code> directive before the closing tag of the <code>VirtualHost</code> directive to import the configuration file where you will write your Rewrite rules.
This is optional but you will find it convenient to clean your installation later or disable all changes you made by just commenting this directive.</p>
<div class="highlight"><pre><span></span><code><span class="nb">Include</span><span class="w"> </span><span class="sx">/etc/apache2/sites-available/my_rewrite_rule_tests.conf</span>
</code></pre></div>
<h2 id="mod_rewrite-logging">mod_rewrite logging<a class="headerlink" href="#mod_rewrite-logging" title="Permanent link">¶</a></h2>
<h3 id="enable-logging">enable logging<a class="headerlink" href="#enable-logging" title="Permanent link">¶</a></h3>
<p>Inside the <code>VirtualHost</code> directive, look for the <a href="http://httpd.apache.org/docs/2.4/en/mod/mod_rewrite.html#logging"><code>LogLevel</code> directive</a>, it may be commented out, or add it.</p>
<p>What matters is having an argument to the directive starting with <code>rewrite</code>, such as the following:</p>
<div class="highlight"><pre><span></span><code>LogLevel<span class="w"> </span>alert<span class="w"> </span>rewrite:trace8
</code></pre></div>
<p>The part after the colon in <code>rewrite:trace8</code> is the logging level.</p>
<p>As we are testing locally, we can use the maximum logging level (level8) but be aware that it should be used carefull (don't go lower than trace3) as mod_rewrite quickly gets extremely verbose.</p>
<h3 id="read-mod_rewrite-logs">read mod_rewrite logs<a class="headerlink" href="#read-mod_rewrite-logs" title="Permanent link">¶</a></h3>
<p>mod_rewrite logs into <code>/var/log/apache2/error.log</code> with a <code>[rewrite</code> prefix.</p>
<div class="highlight"><pre><span></span><code>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/apache2/error.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>fgrep<span class="w"> </span><span class="s1">'[rewrite:'</span><span class="w"> </span>
</code></pre></div>
<h1 id="add-hosts-to-etchosts">Add hosts to /etc/hosts<a class="headerlink" href="#add-hosts-to-etchosts" title="Permanent link">¶</a></h1>
<p>The point here is to make any hostname involved in our rewrite rules point to the local computer (127.0.O.1).</p>
<p>You can then test rewrite rule based on existing host but also on non existing ones.</p>
<blockquote>
<p>for existing host, make sure you revert modifications in <code>/etc/hosts</code> after your are done testing. Otherwise, if you added <code>wwww.google.com</code> and bound it to <code>localhost</code> in <code>/etc/hosts</code> you won't be able to reach the real Google website</p>
</blockquote>
<p>Open <code>/etc/hosts</code> (sudo required):</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/hosts
</code></pre></div>
<p>and add a line such as the following:</p>
<div class="highlight"><pre><span></span><code><span class="m">127</span>.0.0.1<span class="w">    </span>store.mydomain.com<span class="w"> </span>boutique.mydomain.com
</code></pre></div>
<h3 id="bind-apache-to-hostnames">bind Apache to hostnames<a class="headerlink" href="#bind-apache-to-hostnames" title="Permanent link">¶</a></h3>
<p>Add a <code>ServerName</code> directive (if none is already set yet) and any number of <code>ServerAlias</code> directive to bind Apache to hostnames you defined in <code>/etc/hosts</code>.</p>
<p>My advice is to add these directive to the dedicated configuration file created earlier.</p>
<div class="highlight"><pre><span></span><code><span class="nb">ServerName</span><span class="w">              </span>store.mydomain.com
<span class="nb">ServerAlias</span><span class="w">             </span>boutique.mydomain.com
</code></pre></div>
<h3 id="add-rewrite-rules">add rewrite rules<a class="headerlink" href="#add-rewrite-rules" title="Permanent link">¶</a></h3>
<p>Make sure the mod_rewrite engine is enabled by adding the <code>RewriteEngine</code> directive:</p>
<div class="highlight"><pre><span></span><code><span class="nb">RewriteEngine</span><span class="w">   </span><span class="k">On</span>
</code></pre></div>
<p>Now, add your <a href="http://httpd.apache.org/docs/2.4/en/mod/mod_rewrite.html#rewriterule">RewriteRule</a>, <a href="http://httpd.apache.org/docs/2.4/en/mod/mod_rewrite.html#rewritecond">RewriteCond</a> and <a href="http://httpd.apache.org/docs/current/en/mod/mod_rewrite.html#rewritemap">RewriteMap</a> directives.</p>
<h2 id="test-changes">test changes<a class="headerlink" href="#test-changes" title="Permanent link">¶</a></h2>
<p>You can either start/restart or reload Apache after each change.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>/etc/init.d/apache2<span class="w"> </span>start
sudo<span class="w"> </span>/etc/init.d/apache2<span class="w"> </span>restart
<span class="c1"># only reload the configuration without restarting Apache</span>
sudo<span class="w"> </span>/etc/init.d/apache2<span class="w"> </span>reload
</code></pre></div>
<p>Now, open your favorite browser, type in a URL to test, see the result in the browser: are you being redirected or not? to the correct URL?</p>
<p>It does really matter if the URL your are being redirect to actually exists, worse case scenario, you'll get a 404 error but you will know if the rewrite rule worked.</p>
<p>If it is not working, check out the logs.</p>
<p>At log level <code>trace8</code> every operations run by mod_rewrite is visible. This even convenient to understand how the mod and directives work.</p>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2014-11-04T00:00:00+01:00">Tue 04 November 2014</time>
            <h4>Category</h4>
            <a class="category-link" href="https://www.javatronic.fr/categories.html#tips-ref">tips</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://www.javatronic.fr/tags.html#apache-ref">Apache
                    <span class="superscript">1</span>
</a></li>
                <li><a href="https://www.javatronic.fr/tags.html#linux-ref">Linux
                    <span class="superscript">4</span>
</a></li>
                <li><a href="https://www.javatronic.fr/tags.html#testing-ref">Testing
                    <span class="superscript">2</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="https://linkedin.com/in/sebastien-lesaint/" title="Linkedin profile" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://github.com/lesaint/" title="Personal Github" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://github.com/sns-seb/" title="Public Github at SonarSource" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://github.com/lesaint/pelican-theme-elegant/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Personal fork of Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://www.javatronic.fr/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>